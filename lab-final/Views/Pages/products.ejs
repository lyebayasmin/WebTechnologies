<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Products</title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/productsStyle.css">
  <script src="/EjsNavigation.js"></script>
</head>
<body>

<h1>Products</h1>

<!-- FILTER FORM -->
<form method="GET" action="/products" class="filter-form">
  <select name="category">
    <option value="">All Categories</option>
    <option value="Ice Cream" <%= categoryFilter === "Ice Cream" ? "selected" : "" %>>Ice Cream</option>
    <option value="Cone" <%= categoryFilter === "Cone" ? "selected" : "" %>>Cone</option>
    <option value="Cup" <%= categoryFilter === "Cup" ? "selected" : "" %>>Cup</option>
  </select>

  <input type="number" name="minPrice" placeholder="Min Price" value="<%= priceMin %>">
  <input type="number" name="maxPrice" placeholder="Max Price" value="<%= priceMax %>">

  <button type="submit">Apply Filters</button>
</form>

<!-- PRODUCTS -->
<div class="products-container">
  <% if (products && products.length > 0) { %>
    <% products.forEach(product => { %>
      <% console.log('Product ID:', product._id); %> <!-- Debug ID in server console -->
      <div class="product-card">
        <img src="/<%= product.image %>" alt="<%= product.name %>" width="150">
        <h3><%= product.name %></h3>
        <p>Price: $<%= product.price %></p>
        <p>Category: <%= product.category %></p>
        <p><%= product.description %></p>
        <!-- Add to Cart Button -->
        <form action="/add-to-cart/<%= product._id %>" method="GET">
          <button type="submit">Add to Cart</button>
        </form>
      </div>
    <% }) %>
  <% } else { %>
    <p>No products found.</p>
  <% } %>
</div>

<!-- PAGINATION -->
<div class="pagination">
  <% if (currentPage > 1) { %>
    <a href="?page=<%= currentPage - 1 %>&category=<%= categoryFilter %>&minPrice=<%= priceMin %>&maxPrice=<%= priceMax %>">Previous</a>
  <% } %>

  <% for (let i = 1; i <= totalPages; i++) { %>
    <a href="?page=<%= i %>&category=<%= categoryFilter %>&minPrice=<%= priceMin %>&maxPrice=<%= priceMax %>"
       class="<%= i === currentPage ? 'active' : '' %>">
       <%= i %>
    </a>
  <% } %>

  <% if (currentPage < totalPages) { %>
    <a href="?page=<%= currentPage + 1 %>&category=<%= categoryFilter %>&minPrice=<%= priceMin %>&maxPrice=<%= priceMax %>">Next</a>
  <% } %>
</div>

</body>
</html>
